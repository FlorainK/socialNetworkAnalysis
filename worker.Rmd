Datensatz: spotify daten, diese bestehen aus edges und nodes. In edges sind Kollaborationen zwischen zwei Künstlern festgehalten. In den Nodes stehen Zusatzinformationen zu allen Künstlern wie Genre, Follower und Beliebtheit


Einlesen der Datensätze
```{r}

library("igraph")
edges <- read.csv("./data/edges.csv", header = TRUE)
nodes <- read.csv("./data/nodes.csv", header = TRUE)
```


1. Forschungsfrage zum Erkunden des Datensatzes:
  Welches "Künstlerpaar" hatte die meisten Kollaborationen

Benötigt werden hierfür sowohl Edges, als auch Nodes da in den Nodes die Künster nicht mit ihrem Namen enthalten sind, sondern mit einer eindeutigen Identifikationsnummer. Durch diese und die Nodes kann jeder ID der entsprechende Künstlername zugeordnet werden

```{r}
library("tidyverse")
library("dplyr")
# Entfernen der Zeilen, welche eine ID enthalten, die nicht in den nodes steht


filteredEdges <- edges[edges$id_0 %in% nodes$spotify_id, ]
filteredEdges <- filteredEdges[filteredEdges$id_1 %in% nodes$spotify_id, ]

# Anzahl der Künstler, die mehr als eine Kollaboration hatten:
counts <- group_size(group_by(filteredEdges, id_0, id_1))
counts[counts > 1]
```
2. Forschungsfrage:
  Welche Genres sind am häufigsten in dem Datensatz enthalten

```{r}

numberOfGenres <- function(element) {
  element <- strsplit(element, ",")
  element <- unlist(element)
  return(length(element))
}

# Add column with genre of artist 0
filteredEdges["genre_0"] <- nodes[match(filteredEdges$id_0, nodes$spotify_id), "genres"]
# Add column with genre of artist 1
filteredEdges["genre_1"] <- nodes[match(filteredEdges$id_1, nodes$spotify_id), "genres"]


# transform the rows genre_0 and genre_1 into a vector
filteredEdges$genre_0 <- as.vector(filteredEdges$genre_0)
filteredEdges$genre_1 <- as.vector(filteredEdges$genre_1)

# create a new column with the genres of both artists
filteredEdges$genres <- paste(filteredEdges$genre_0, filteredEdges$genre_1, sep = ", ")

# remove the columns genre_0 and genre_1
filteredEdges <- filteredEdges[, -c(3, 4)]


#  count the genres
genreCounts <- table(unlist(strsplit(as.character(filteredEdges$genres), ", ")))
genreCounts <- as.data.frame(genreCounts)
colnames(genreCounts) <- c("genre", "count")
genreCounts <- genreCounts[order(genreCounts$count, decreasing = TRUE), ]

# remove [ and ] from the genres and replace no gonre with unknown
genreCounts$genre <- str_replace(genreCounts$genre, "\\[\\]", "unknown")
genreCounts$genre <- gsub("\\[", "", genreCounts$genre)
genreCounts$genre <- gsub("\\]", "", genreCounts$genre)


# plot the top 10 genres
ggplot(genreCounts[1:10, ], aes(x = reorder(genre, count), y = count)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Genre", y = "Count of Collaborations", title = "Top 10 Genres in the Dataset")

# calculate mean number of genres per artist

mean(unlist(lapply(filteredEdges$genres, numberOfGenres)))
```

-> Die häufigsten Genres sind Pop, edm und electro house
  -> Dennoch sind die meisten Kollaborationen mit einem oder beiden Künstlern ohne zugeordnetes Genre
  -> Durchschnittlich 4,9 genres pro Künsterin

3. Forschungsfrage:
  wie sind die einzelnen Genres untereinander vernetzt

Hierfür wird lediglich ein genre pro Künstler betrachtet


```{r}
library(GGally)
library(network)
library(tibble)
genreCollaborations <- filteredEdges[, c(1, 2)]

getFirstGenre <- function(genreList) {
  if (length(genreList) == 4) {
    return("unknown")
  } else {
    quotePositions <- unlist(gregexpr("\\'", genreList))
    return(substr(genreList, quotePositions[1] + 1, quotePositions[2] - 1))
  }
}

# add column with genre of artist 0
genreCollaborations["genre_0"] <- nodes[match(genreCollaborations$id_0, nodes$spotify_id), "genres"]
# add column with genre of artist 1
genreCollaborations["genre_1"] <- nodes[match(genreCollaborations$id_1, nodes$spotify_id), "genres"]

# keep only first genre per artist
genreCollaborations$genre_0 <- sapply(genreCollaborations$genre_0, getFirstGenre)
genreCollaborations$genre_1 <- sapply(genreCollaborations$genre_1, getFirstGenre)

# remove rows with unknown genre
genreCollaborations <- subset(genreCollaborations, genre_0 != "NA" & genre_1 != "NA")

# remove rows with same genre
genreCollaborations <- subset(genreCollaborations, genre_0 != genre_1)
# remove first two columns
genreCollaborations <- genreCollaborations[, -c(1, 2)]

# create a network
genreNetwork <- network(genreCollaborations, directed = FALSE, multiple = TRUE)

# plot the network
plot(genreNetwork, vertex.label = NA, vertex.size = 5, vertex.color = "blue", edge.width = 0.1, edge.color = "grey")

# calculate the degree of each genre
genreDegree <- degree(graph_from_data_frame(genreCollaborations, directed = FALSE, vertices = NULL))
genreDegree <- as.data.frame(genreDegree)
genreDegree <- tibble::rownames_to_column(genreDegree, "genre")
colnames(genreDegree) <- c("genre", "degree")
genreDegree <- genreDegree[order(genreDegree$degree, decreasing = TRUE), ]

# plot the top 10 genres
ggplot(genreDegree[1:10, ], aes(x = reorder(genre, degree), y = degree)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Genre", y = "Degree", title = "Top 10 Genres by Degree")
```


Weitere Idee:
  Wie Kollaborieren die 20 größten Artists miteinander